# VDYP Batch Application Configuration
spring.application.name=VDYP Batch Processing API

# Server Configuration
server.port=8081
server.servlet.context-path=/vdyp-batch

# Multipart File Upload Configuration
spring.servlet.multipart.max-file-size=500MB
spring.servlet.multipart.max-request-size=500MB

# Batch Configuration
spring.batch.jdbc.initialize-schema=always
spring.batch.job.enabled=false
spring.batch.job.name=NONE
spring.batch.jdbc.isolation-level-for-create=SERIALIZABLE

# Transaction Management
# - Larger transaction timeout for processing large chunks
spring.transaction.default-timeout=300
spring.jpa.properties.hibernate.jdbc.batch_size=150

# Log levels - Reduced logging for better performance
logging.level.root=WARN
logging.level.org.springframework.batch=WARN
logging.level.org.springframework.batch.core.step=WARN

# VDYP all non-batch VDYP Module Logging
logging.level.ca.bc.gov.nrs.vdyp=OFF

# Batch module Logging
logging.level.ca.bc.gov.nrs.vdyp.batch=INFO
logging.level.ca.bc.gov.nrs.vdyp.batch.service=INFO
logging.level.ca.bc.gov.nrs.vdyp.batch.configuration=INFO
logging.level.ca.bc.gov.nrs.vdyp.batch.controller=INFO
logging.level.ca.bc.gov.nrs.vdyp.batch.model=INFO

# Job Configuration
batch.job.auto-create=true

# Root Directory Configuration
batch.root-directory=${user.home}/vdyp

# Partition Configuration
batch.partition.default-partition-size=12
batch.partition.min-valid-file-size=1024
batch.partition.interim-dirs-cleanup-enabled=false

# Reader Configuration 
# - Throughput
batch.reader.default-chunk-size=150

# Thread Pool Configuration
# - Match thread pool to partition size
batch.thread-pool.core-pool-size=12
batch.thread-pool.max-pool-size-multiplier=1
batch.thread-pool.thread-name-prefix=vdyp-batch-partition-

# Production Error Handling Configuration
batch.retry.max-attempts=5
batch.retry.backoff-period=100
batch.skip.max-count=50000

# Data Validation Configuration
batch.validation.max-data-length=50000
batch.validation.min-polygon-id-length=1
batch.validation.max-polygon-id-length=50

# Database Configuration - local development
# - LOCK_TIMEOUT=10000: 10 second lock timeout to prevent deadlock
# - CACHE_SIZE=131072: 128MB cache
# - MAX_MEMORY_ROWS=100000
# - MV_STORE=TRUE: MVStore engine
spring.datasource.url=jdbc:h2:mem:batchdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=REGULAR;LOCK_TIMEOUT=10000;CACHE_SIZE=131072;MAX_MEMORY_ROWS=100000;MV_STORE=TRUE
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.h2.console.enabled=false
spring.h2.console.settings.web-allow-others=false

# HikariCP Connection Pool Configuration
# - Pool size calculation formula: (partitions × 2) + overhead = (12 × 2) + 6 = 30 connections
# - Each partition worker: 1 connection for read + 1 for write transactions
# - Overhead: Master thread, async operations, connection validation
spring.datasource.hikari.maximum-pool-size=30
spring.datasource.hikari.minimum-idle=15
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# Leak Detection Threshold
# - Must be longer than max chunk processing time
# - 5 minutes (300 seconds) to avoid false leak warnings
spring.datasource.hikari.leak-detection-threshold=300000

spring.datasource.hikari.validation-timeout=5000

# Native Image Configuration
spring.sql.init.mode=always

# Actuator Configuration (for monitoring)
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always
management.simple.metrics.export.enabled=true

# VDYP Component Version Configuration (required by vdyp-extended-core)
COMPANY_NAME=Vivid Solutions, Inc.
BINARY_PRODUCT=VDYP7
BINARY_EXTENSION=JAR
VERSION_MAJOR=8
VERSION_MINOR=0
VERSION_INC=0
VERSION_BUILD=1
VERSION_YEAR=2023
VERSION_MONTH=12
VERSION_DAY=11
COPYRIGHT_START=2023
COPYRIGHT_END=2023
VERSION_CONTROL_SYSTEM=git
VERSION_CONTROL_VERSION=2023
BRANCH_NAME=main
LAST_COMMIT_REFERENCE=
LAST_COMMIT_AUTHOR=
LAST_COMMIT_DATE=
BUILD_MACHINE=localhost
ENV_COMPILER=javac
ENV_COMPILER_VER=17
ENV_BUILD_CONFIG=Release
ENV_OS=JVM
ENV_ARCH=jdk-17.0.2.jdk
